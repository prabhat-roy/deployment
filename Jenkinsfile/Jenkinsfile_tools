pipeline {
  agent any

  environment {
    ENV_FILE_PATH = 'groovy/Deployment.env'
  }

  stages {
    stage('Load Environment Variables') {
      steps {
        script {
          def envLoader = load 'groovy/LoadEnvVars.groovy'
          if (envLoader == null) {
            error "[FATAL] Could not load env loader script."
          }

          def envVars = envLoader.call(ENV_FILE_PATH)

          envVars.each { key, value ->
            echo "[INFO] Injecting: ${key}=${value}"
            env[key] = value
          }
        }
      }
    }
  }
}
