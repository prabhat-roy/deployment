pipeline {
    agent any
    parameters {
        choice(
            name: 'ACTION',
            choices: ['create', 'destroy'], 
            description: 'Choose whether to create or destroy kubernetes resources.'
        )
    }
    stages {
        stage('Git Checkout') {
            steps {
                script {
                    checkout scm
                    }
                }
            }
            stage('Load Environment Variables') {
                steps {
                    script {
                        unstash 'env-file'                        
                    }
                }
            }
            stage('Create Cloud Repositories') {
                steps {
                    script {
                        def repoCreator = load 'groovy/cloud_repo.groovy'
                        repoCreator.createCloudRepo(params.ACTION)
                    }
                }
            }
            stage('Create Docker Images') {
                steps {
                    script {
                        def dockerBuild = load 'groovy/docker_build.groovy'
                        dockerBuild.createDockerBuild()
                    }
                }
            }
    }
}

        
